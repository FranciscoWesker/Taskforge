services:
  - type: web
    name: taskforge-backend
    env: node
    plan: free
    rootDir: backend
    healthCheckPath: /health
    buildCommand: NPM_CONFIG_PRODUCTION=false npm install && npm run build
    startCommand: node dist/server.js
    autoDeploy: true
    envVars:
      - key: CLIENT_ORIGIN
        value: https://taskforge-21m4.onrender.com
      - key: BACKEND_URL
        value: https://taskforge-ufzf.onrender.com
      - key: MONGODB_URI
        sync: false
      # IMPORTANTE: USE_MEM_MONGO debe ser "false" en producción
      # MongoDB en memoria se pierde al reiniciar el servidor (cada 15 min en Render free tier)
      # Este valor sobrescribe cualquier configuración en el dashboard de Render
      - key: USE_MEM_MONGO
        value: "false"

# NOTA: Los sitios estáticos no se pueden definir en render.yaml blueprints
# El frontend (taskforge-frontend) debe crearse manualmente en el dashboard de Render:
# 1. Ir a Dashboard → New → Static Site
# 2. Conectar el repositorio
# 3. Configurar:
#    - Name: taskforge-frontend
#    - Root Directory: frontend
#    - Build Command: npm install && npm run build
#    - Publish Directory: dist/taskforge-ui/browser
#    - Headers: Content-Security-Policy (ver configuración en frontend/public/_redirects)
#    - Redirects: /* -> /index.html (status 200)

